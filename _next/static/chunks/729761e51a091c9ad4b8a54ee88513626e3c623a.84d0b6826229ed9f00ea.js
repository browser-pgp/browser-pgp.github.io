(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"6pqD":function(e,t,n){"use strict";n.d(t,"b",(function(){return v})),n.d(t,"a",(function(){return k}));var r=n("KQm4"),a=n("o0o1"),i=n.n(a),o=n("rePB"),c=n("ODXe"),u=n("q1tI"),s=n.n(u),l=n("zP5H"),f=Object(l.a)((function(){return Object(u.useState)({open:!1,pending:!1,id:"",cb:function(){return 0}})})),p=n("EHhu"),d=n("XFFy");function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v=function(){var e=f.useContainer(),t=Object(c.a)(e,2),n=t[0],a=t[1],o=Object(d.c)("\u5220\u9664\u7528\u6237"),u=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];a((function(e){return y({},e,{open:!1})})),n.cb(e)};return{state:n,setState:a,open:function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){a((function(n){return y({},n,{open:!0,id:e,cb:t})}))})));case 1:case"end":return t.stop()}}),null,null,null,Promise)},close:u,remove:function(){var e;return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.pending){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",(e=Promise.resolve(a((function(e){return y({},e,{pending:!0})}))).then((function(){var e;return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.a.awrap(p.b.users.findOne().where("fingerprint").eq(n.id).exec());case 2:return e=t.sent,t.next=5,i.a.awrap(e.remove());case 5:u(!0);case 6:case"end":return t.stop()}}),null,null,null,Promise)}))).then.apply(e,Object(r.a)(o)).finally((function(){a((function(e){return y({},e,{pending:!1})}))})));case 3:case"end":return t.stop()}}),null,null,null,Promise)}}},m=(n("PsDL"),n("FrwU"),s.a.createElement,n("kfFl")),O=n("yv+Y"),g=n("EQI2"),w=n("+JwS"),h=n("Z3vd"),P=s.a.createElement,j=function(){var e=v(),t=e.state,n=e.close,r=e.remove;return P(m.a,{open:t.open,onClose:t.pending?function(){return 0}:function(){return n()}},P(O.a,null,"\u5220\u9664\u786e\u8ba4 ?"),P(g.a,null,"\u786e\u8ba4\u662f\u5426\u5220\u9664 ",t.id,", \u5220\u9664\u540e\u5c06\u65e0\u6cd5\u627e\u56de"),P(w.a,null,P(h.a,{disabled:t.pending,onClick:function(){return n()}},"\u53d6\u6d88"),P(h.a,{disabled:t.pending,color:"primary",onClick:function(){return r()}},"\u5220\u9664")))},x=s.a.createElement,k=function(e){return x(f.Provider,null,x(j,null),e.children)}},csR4:function(e,t,n){"use strict";n.d(t,"b",(function(){return E})),n.d(t,"a",(function(){return _}));var r,a=n("KQm4"),i=n("o0o1"),o=n.n(i),c=n("rePB"),u=n("ODXe"),s=n("q1tI"),l=n.n(s),f=n("5PFF"),p=n("zP5H");!function(e){e.PublicKey="PublicKey",e.PrivateKey="PrivateKey",e.RevocationCertificate="RevocationCertificate"}(r||(r={}));var d=Object(p.a)((function(){var e=Object(s.useMemo)((function(){var e={};for(var t in r)e[t]=f.c.createModel("");return e}),[]);return Object(s.useState)({open:!1,pending:!1,models:e,focus:r.PublicKey,id:!1,cb:function(){return 0}})})),b=Object(p.a)((function(){return Object(s.useState)({})})),y=n("QYcz"),v=n("EHhu"),m=n("XFFy"),O="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),g=new Uint8Array(16);function w(){if(!O)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(g)}for(var h=[],P=0;P<256;++P)h[P]=(P+256).toString(16).substr(1);var j=function(e,t){var n=t||0,r=h;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")};var x=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||w)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var i=0;i<16;++i)t[r+i]=a[i];return t||j(a)},k=n("jouk"),K=n("uBBE");function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){Object(c.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E=function(){var e=d.useContainer(),t=Object(u.a)(e,2),n=t[0],i=t[1],s=b.useContainer(),l=Object(u.a)(s,2),f=l[0],p=l[1],O=Object(m.c)("\u5bfc\u5165\u7528\u6237"),g=Object(m.c)("\u66f4\u65b0\u7528\u6237"),w=Object(m.c)("\u68c0\u67e5\u5bc6\u94a5\u5bf9"),h=Object(K.b)(),P=function(){i((function(e){return C({},e,{open:!1})})),i((function(e){return e.cb(),e}))},j=function(e){return new Promise((function(t){e?(i((function(n){return C({},n,{open:!0,pending:!0,id:e,focus:r.PublicKey,cb:t})})),v.b.users.findOne().where("fingerprint").eq(e).exec().then((function(e){n.models[r.PublicKey].setValue(e.publicKey),n.models[r.PrivateKey].setValue(e.privateKey||""),n.models[r.RevocationCertificate].setValue(e.revocationCertificate||"")})).finally((function(){i((function(e){return C({},e,{pending:!1})}))}))):i((function(e){for(var n in e.models){e.models[n].setValue("")}return C({},e,{open:!0,id:!1,focus:r.PublicKey,cb:t})}))}))},S=function(e){var t,n,a,i,c,u,s,l,f,p,d=arguments;return o.a.async((function(b){for(;;)switch(b.prev=b.next){case 0:if(t=d.length>1&&void 0!==d[1]?d[1]:E(r.PublicKey),n=d.length>2&&void 0!==d[2]?d[2]:E(r.PrivateKey),a=d.length>3?d[3]:void 0,t){b.next=6;break}throw D(r.PublicKey,e),new m.a("\u7f3a\u5c11\u516c\u94a5");case 6:if(n){b.next=9;break}throw D(r.PrivateKey,e),new m.a("\u7f3a\u5c11\u79c1\u94a5");case 9:return b.next=11,o.a.awrap(y.key.readArmored(t).then((function(t){var n,a=t.keys,i=t.err;if(null===i||void 0===i?void 0:i[0])throw D(r.PublicKey,e),new m.a("\u516c\u94a5\u89e3\u6790\u51fa\u73b0\u95ee\u9898: ".concat(null===(n=i[0])||void 0===n?void 0:n.message));return a[0]})));case 11:return i=b.sent,b.next=14,o.a.awrap(y.key.readArmored(n).then((function(t){var n,a=t.keys,i=t.err;if(null===i||void 0===i?void 0:i[0])throw D(r.PrivateKey,e),new m.a("\u79c1\u94a5\u89e3\u6790\u51fa\u73b0\u95ee\u9898: ".concat(null===(n=i[0])||void 0===n?void 0:n.message));return a[0]})));case 14:if(c=b.sent,a){b.next=19;break}return b.next=18,o.a.awrap(h.open(n));case 18:a=b.sent;case 19:if(a){b.next=21;break}throw new m.a("\u7f3a\u5c11\u5bc6\u7801");case 21:return b.next=23,o.a.awrap(c.decrypt(a));case 23:return u=x(),b.next=26,o.a.awrap(y.encrypt({message:y.message.fromText(u),publicKeys:[i]}));case 26:return s=b.sent,l=s.data,b.t0=o.a,b.t1=y,b.next=32,o.a.awrap(y.message.readArmored(l));case 32:return b.t2=b.sent,b.t3=[c],b.t4={message:b.t2,privateKeys:b.t3},b.t5=b.t1.decrypt.call(b.t1,b.t4),b.next=38,b.t0.awrap.call(b.t0,b.t5);case 38:if(f=b.sent,p=f.data,u===p){b.next=42;break}throw new m.a("\u5bc6\u94a5\u5bf9\u4e0d\u5339\u914d");case 42:return b.abrupt("return",a);case 43:case"end":return b.stop()}}),null,null,null,Promise)},E=function(e){return n.models[e].getValue()},V=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.focus;return e===r.PublicKey&&!!n.id},D=function(e,t){p(C({},f,Object(c.a)({},n.focus,t.saveViewState()))),t.updateOptions({readOnly:V(e)}),n.focus!==e?i((function(t){return C({},t,{focus:e})})):t.focus()};return{state:n,setState:i,viewState:f,close:P,open:j,importUser:function(e){var t;return o.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(!n.pending){c.next=2;break}return c.abrupt("return");case 2:return c.abrupt("return",(t=Promise.resolve(i((function(e){return C({},e,{pending:!0})}))).then((function(){var t,a,c,u,s,l,f,d;return o.a.async((function(b){for(;;)switch(b.prev=b.next){case 0:if(t=E(r.PublicKey),a=E(r.PrivateKey),c=E(r.RevocationCertificate),t){b.next=6;break}throw D(r.PublicKey,e),new m.a("\u7f3a\u5c11\u516c\u94a5");case 6:if(!a||n.id){b.next=9;break}return b.next=9,o.a.awrap(S(e,t,a));case 9:return b.next=11,o.a.awrap(y.key.readArmored(t).then((function(t){var n,a=t.keys,i=t.err;if(null===i||void 0===i?void 0:i[0])throw D(r.PublicKey,e),new m.a("\u516c\u94a5\u89e3\u6790\u51fa\u73b0\u95ee\u9898: ".concat(null===(n=i[0])||void 0===n?void 0:n.message));return a[0]})));case 11:return u=b.sent,s=u.getFingerprint(),b.next=15,o.a.awrap(v.b.users.findOne().where("fingerprint").eq(s).exec());case 15:if(l=b.sent,!n.id){b.next=35;break}if(a===l.privateKey){b.next=30;break}if(a){b.next=26;break}return b.next=21,o.a.awrap(h.open(l.privateKey));case 21:if(b.sent){b.next=24;break}throw new m.a("\u5220\u9664\u79c1\u94a5\u9700\u8981\u5bc6\u7801\u9a8c\u8bc1");case 24:b.next=28;break;case 26:return b.next=28,o.a.awrap(S(e,t,a));case 28:return b.next=30,o.a.awrap(l.atomicSet("privateKey",a));case 30:if(c===l.revocationCertificate){b.next=33;break}return b.next=33,o.a.awrap(l.atomicSet("revocationCertificate",c));case 33:return P(),b.abrupt("return");case 35:if(!l){b.next=38;break}throw j(s),new m.a('\u516c\u94a5\u5df2\u5b58\u5728, \u6253\u5f00"\u66f4\u65b0\u7528\u6237"');case 38:return b.t0=k.c,b.next=41,o.a.awrap(u.getPrimaryUser());case 41:return b.t1=b.sent.user.userId,f=(0,b.t0)(b.t1),d={publicKey:t,fingerprint:s,name:f.name,email:f.email},a&&(d.privateKey=a),c&&(d.revocationCertificate=c),b.next=48,o.a.awrap(v.b.users.insert(d));case 48:p({}),P(),i((function(e){for(var t in e.models){e.models[t].setValue("")}return e}));case 51:case"end":return b.stop()}}),null,null,null,Promise)}))).then.apply(t,Object(a.a)(n.id?g:O)).finally((function(){i((function(e){return C({},e,{pending:!1})}))})));case 3:case"end":return c.stop()}}),null,null,null,Promise)},changeEditorTab:D,setViewState:p,checkPrivateKey:function(){var e;return(e=S.apply(void 0,arguments)).then.apply(e,Object(a.a)(w))},isShouldMakePublicKeyReadOnly:V}},V=n("kfFl"),D=n("yv+Y"),R=n("EQI2"),F=n("dfam"),H=n("JrkS"),I=n("de8u"),q=n("+JwS"),N=n("Z3vd"),A=n("6pqD"),B=l.a.createElement,M=function(){var e=Object(A.b)(),t=E();return B(N.a,{style:{float:"right"},onClick:function(){return e.open(t.state.id).then((function(e){return e&&t.close()}))}},"\u5220\u9664")},U=n("R/WZ"),J=l.a.createElement;function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){Object(c.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var z=Object(U.a)((function(e){return{editor:{height:"40vh",minHeight:375,maxHeight:500},head:{paddingBottom:e.spacing(1)},content:{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0},tabs:{minHeight:0},tab:{minHeight:0,paddingLeft:e.spacing(3),paddingRight:e.spacing(3)},tabIndicator:{minWidth:0}}})),W={fontSize:14,minimap:{enabled:!1}},X=function(e,t){return{displayName:t,value:e}},L=[X(r.PublicKey,"\u516c\u94a5"),X(r.PrivateKey,"\u79c1\u94a5"),X(r.RevocationCertificate,"\u540a\u9500\u8bc1\u4e66")],Y=function(){var e=Object(k.d)(),t=E(),n=z(),a=f.b.useContainer(),i=Object(u.a)(a,1)[0].editor;return Object(s.useEffect)((function(){i&&(t.state.pending?i.updateOptions({readOnly:t.state.pending}):i.updateOptions({readOnly:t.isShouldMakePublicKeyReadOnly()}))}),[t.state.pending]),Object(s.useEffect)((function(){if(i)if(i.updateOptions({readOnly:t.isShouldMakePublicKeyReadOnly()}),t.state.open){var e=t.viewState[t.state.focus];e&&i.restoreViewState(e)}else{var n=i.saveViewState();t.setViewState((function(e){return T({},e,Object(c.a)({},t.state.focus,n))}))}}),[t.state.open,i]),Object(s.useEffect)((function(){if(i){i.setModel(t.state.models[t.state.focus]),i.focus();var e=t.viewState[t.state.focus];e&&i.restoreViewState(e)}}),[t.state.focus]),J(s.Fragment,null,J(D.a,{className:n.head},t.state.id?"\u66f4\u65b0\u7528\u6237":"\u7528\u6237\u5bfc\u5165",t.state.id&&J(M,null)),J(R.a,{className:n.content},J(F.a,{variant:"scrollable",indicatorColor:"primary",className:n.tabs,TabIndicatorProps:{className:n.tabIndicator},value:t.state.focus,onChange:function(e,n){return t.changeEditorTab(n,i)}},L.map((function(e){return J(H.a,{className:n.tab,key:e.value,label:e.displayName,disabled:t.state.pending,value:e.value})}))),J(I.a,{style:t.state.pending?{}:{visibility:"hidden"}}),J(f.a,{classes:[n.editor],options:T({},W,{model:t.state.models[t.state.focus]})})),J(q.a,null,J(N.a,{disabled:t.state.pending,onClick:function(){return t.close()}},"\u53d6\u6d88"),(t.viewState[r.PrivateKey]||t.state.focus===r.PrivateKey)&&J(N.a,{onClick:function(){return t.checkPrivateKey(i)}},"\u68c0\u67e5\u5bc6\u94a5\u5bf9"),J(N.a,{onClick:function(){return e.open(t.state.models[t.state.focus].getValue())}},"\u67e5\u770b\u516c\u94a5"),t.state.id?J(N.a,{type:"submit",color:"primary",onClick:function(){return t.importUser(i)},disabled:t.state.pending},"\u66f4\u65b0"):J(N.a,{type:"submit",color:"primary",onClick:function(){return t.importUser(i)},disabled:t.state.pending},"\u5bfc\u5165")))},Z=l.a.createElement,G=function(){var e=E(),t=e.state,n=e.close;return Z(V.a,{open:t.open,onClose:t.pending?function(){return 0}:n,fullWidth:!0,maxWidth:"sm"},Z(f.b.Provider,null,Z(Y,null)))},$=l.a.createElement,_=function(e){return $(d.Provider,null,$(b.Provider,null,$(G,null),e.children))}}}]);